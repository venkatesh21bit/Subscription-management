core/models/base.py
import uuid
from django.db import models
from django.conf import settings


class BaseModel(models.Model):
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        abstract = True


class CompanyScopedModel(BaseModel):
    company = models.ForeignKey("company.Company", on_delete=models.CASCADE)

    class Meta:
        abstract = True

company/models.py
class Currency(BaseModel):
    code = models.CharField(max_length=10, unique=True)
    name = models.CharField(max_length=50)
    symbol = models.CharField(max_length=10)
    decimal_places = models.PositiveSmallIntegerField(default=2)


class Company(BaseModel):
    code = models.CharField(max_length=20, unique=True)
    name = models.CharField(max_length=255)
    legal_name = models.CharField(max_length=255)
    company_type = models.CharField(max_length=50)
    timezone = models.CharField(max_length=50)
    language = models.CharField(max_length=20)
    base_currency = models.ForeignKey(Currency, on_delete=models.PROTECT)
    is_active = models.BooleanField(default=True)
    is_deleted = models.BooleanField(default=False)


class Address(CompanyScopedModel):
    address_type = models.CharField(max_length=30)
    line1 = models.CharField(max_length=255)
    line2 = models.CharField(max_length=255, blank=True)
    city = models.CharField(max_length=100)
    state = models.CharField(max_length=100)
    country = models.CharField(max_length=100)
    pincode = models.CharField(max_length=20)


class CompanyFeature(CompanyScopedModel):
    inventory_enabled = models.BooleanField(default=True)
    accounting_enabled = models.BooleanField(default=True)
    payroll_enabled = models.BooleanField(default=False)
    gst_enabled = models.BooleanField(default=False)
    locked = models.BooleanField(default=False)


class CompanyUser(CompanyScopedModel):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    role = models.CharField(max_length=50)
    is_default = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)

    class Meta:
        unique_together = ("user", "company")


class FinancialYear(CompanyScopedModel):
    name = models.CharField(max_length=20)
    start_date = models.DateField()
    end_date = models.DateField()
    is_current = models.BooleanField(default=False)
    is_closed = models.BooleanField(default=False)


class Sequence(CompanyScopedModel):
    key = models.CharField(max_length=50)
    prefix = models.CharField(max_length=20, blank=True)
    last_value = models.PositiveIntegerField(default=0)
    reset_period = models.CharField(max_length=20)

inventory/models.py
class UnitOfMeasure(BaseModel):
    name = models.CharField(max_length=50)
    symbol = models.CharField(max_length=10)
    category = models.CharField(max_length=30)


class StockItem(CompanyScopedModel):
    sku = models.CharField(max_length=100)
    name = models.CharField(max_length=255)
    description = models.TextField(blank=True)
    uom = models.ForeignKey(UnitOfMeasure, on_delete=models.PROTECT)
    is_stock_item = models.BooleanField(default=True)
    is_active = models.BooleanField(default=True)

    class Meta:
        unique_together = ("company", "sku")


class PriceList(CompanyScopedModel):
    name = models.CharField(max_length=100)
    currency = models.ForeignKey("company.Currency", on_delete=models.PROTECT)
    is_default = models.BooleanField(default=False)
    valid_from = models.DateField()
    valid_to = models.DateField(null=True, blank=True)


class ItemPrice(BaseModel):
    item = models.ForeignKey(StockItem, on_delete=models.CASCADE)
    price_list = models.ForeignKey(PriceList, on_delete=models.CASCADE)
    rate = models.DecimalField(max_digits=14, decimal_places=4)
    valid_from = models.DateField()
    valid_to = models.DateField(null=True, blank=True)


class StockBatch(CompanyScopedModel):
    item = models.ForeignKey(StockItem, on_delete=models.CASCADE)
    batch_number = models.CharField(max_length=100)
    mfg_date = models.DateField(null=True, blank=True)
    exp_date = models.DateField(null=True, blank=True)
    is_active = models.BooleanField(default=True)


class Godown(CompanyScopedModel):
    name = models.CharField(max_length=100)
    code = models.CharField(max_length=50)
    address = models.ForeignKey("company.Address", on_delete=models.SET_NULL, null=True)
    is_active = models.BooleanField(default=True)

accounting/models.py
class AccountGroup(CompanyScopedModel):
    name = models.CharField(max_length=100)
    code = models.CharField(max_length=50)
    parent = models.ForeignKey("self", null=True, blank=True, on_delete=models.PROTECT)
    nature = models.CharField(max_length=20)
    report_type = models.CharField(max_length=10)
    path = models.CharField(max_length=255)


class Ledger(CompanyScopedModel):
    code = models.CharField(max_length=50)
    name = models.CharField(max_length=255)
    group = models.ForeignKey(AccountGroup, on_delete=models.PROTECT)
    account_type = models.CharField(max_length=30)
    opening_balance = models.DecimalField(max_digits=16, decimal_places=2, default=0)
    opening_balance_type = models.CharField(max_length=2)
    opening_balance_fy = models.ForeignKey(
        "company.FinancialYear", on_delete=models.PROTECT
    )
    is_bill_wise = models.BooleanField(default=False)
    is_cost_center_applicable = models.BooleanField(default=False)
    requires_reconciliation = models.BooleanField(default=False)
    is_system = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)

    class Meta:
        unique_together = ("company", "code")


class TaxLedger(BaseModel):
    ledger = models.OneToOneField(Ledger, on_delete=models.CASCADE)
    tax_type = models.CharField(max_length=20)
    rate = models.DecimalField(max_digits=6, decimal_places=2)
    tax_direction = models.CharField(max_length=10)
    effective_from = models.DateField()


class CostCenter(CompanyScopedModel):
    code = models.CharField(max_length=50)
    name = models.CharField(max_length=100)
    is_active = models.BooleanField(default=True)

party/models.py
class Party(CompanyScopedModel):
    name = models.CharField(max_length=255)
    party_type = models.CharField(max_length=20)
    email = models.EmailField(blank=True)
    phone = models.CharField(max_length=20)
    is_active = models.BooleanField(default=True)


class PartyLedger(BaseModel):
    party = models.OneToOneField(Party, on_delete=models.CASCADE)
    ledger = models.OneToOneField("accounting.Ledger", on_delete=models.CASCADE)


class PartyAddress(BaseModel):
    party = models.ForeignKey(Party, on_delete=models.CASCADE)
    address_type = models.CharField(max_length=20)
    line1 = models.CharField(max_length=255)
    city = models.CharField(max_length=100)
    state = models.CharField(max_length=100)
    country = models.CharField(max_length=100)
    pincode = models.CharField(max_length=20)


class PartyBankAccount(BaseModel):
    party = models.ForeignKey(Party, on_delete=models.CASCADE)
    bank_name = models.CharField(max_length=100)
    account_number = models.CharField(max_length=50)
    ifsc = models.CharField(max_length=20)
    is_primary = models.BooleanField(default=False)

orders/models.py
class SalesOrder(CompanyScopedModel):
    order_number = models.CharField(max_length=50)
    customer = models.ForeignKey("party.Party", on_delete=models.PROTECT)
    status = models.CharField(max_length=20)
    order_date = models.DateField()
    delivery_date = models.DateField(null=True, blank=True)
    currency = models.ForeignKey("company.Currency", on_delete=models.PROTECT)


class PurchaseOrder(CompanyScopedModel):
    order_number = models.CharField(max_length=50)
    supplier = models.ForeignKey("party.Party", on_delete=models.PROTECT)
    status = models.CharField(max_length=20)
    order_date = models.DateField()
    expected_date = models.DateField(null=True, blank=True)
    currency = models.ForeignKey("company.Currency", on_delete=models.PROTECT)


class OrderItem(CompanyScopedModel):
    sales_order = models.ForeignKey(SalesOrder, null=True, blank=True, on_delete=models.CASCADE)
    purchase_order = models.ForeignKey(PurchaseOrder, null=True, blank=True, on_delete=models.CASCADE)
    item = models.ForeignKey("inventory.StockItem", on_delete=models.PROTECT)
    quantity = models.DecimalField(max_digits=12, decimal_places=3)
    uom = models.ForeignKey("inventory.UnitOfMeasure", on_delete=models.PROTECT)
    unit_rate = models.DecimalField(max_digits=14, decimal_places=4)
    discount_pct = models.DecimalField(max_digits=5, decimal_places=2, default=0)

invoice/models.py
class Invoice(CompanyScopedModel):
    invoice_number = models.CharField(max_length=50)
    invoice_date = models.DateField()
    party = models.ForeignKey("party.Party", on_delete=models.PROTECT)
    invoice_type = models.CharField(max_length=20)
    due_date = models.DateField()
    currency = models.ForeignKey("company.Currency", on_delete=models.PROTECT)
    financial_year = models.ForeignKey("company.FinancialYear", on_delete=models.PROTECT)
    status = models.CharField(max_length=20)


class InvoiceLine(BaseModel):
    invoice = models.ForeignKey(Invoice, on_delete=models.CASCADE)
    item = models.ForeignKey("inventory.StockItem", on_delete=models.PROTECT)
    description = models.CharField(max_length=255)
    quantity = models.DecimalField(max_digits=12, decimal_places=3)
    unit_rate = models.DecimalField(max_digits=14, decimal_places=4)

voucher/models.py
class VoucherType(CompanyScopedModel):
    name = models.CharField(max_length=100)
    code = models.CharField(max_length=50)
    category = models.CharField(max_length=30)
    is_accounting = models.BooleanField(default=True)
    is_inventory = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)


class Voucher(CompanyScopedModel):
    voucher_type = models.ForeignKey(VoucherType, on_delete=models.PROTECT)
    financial_year = models.ForeignKey("company.FinancialYear", on_delete=models.PROTECT)
    voucher_number = models.CharField(max_length=50)
    date = models.DateField()
    narration = models.TextField(blank=True)
    status = models.CharField(max_length=20)
    reversed_voucher = models.ForeignKey("self", null=True, blank=True, on_delete=models.PROTECT)


class VoucherLine(BaseModel):
    voucher = models.ForeignKey(Voucher, on_delete=models.CASCADE)
    ledger = models.ForeignKey("accounting.Ledger", on_delete=models.PROTECT)
    amount = models.DecimalField(max_digits=16, decimal_places=2)
    entry_type = models.CharField(max_length=2)

hr/models.py
class Department(CompanyScopedModel):
    name = models.CharField(max_length=100)
    manager = models.ForeignKey("Employee", null=True, blank=True, on_delete=models.SET_NULL)


class Employee(CompanyScopedModel):
    employee_code = models.CharField(max_length=50)
    user = models.ForeignKey(settings.AUTH_USER_MODEL, null=True, blank=True, on_delete=models.SET_NULL)
    name = models.CharField(max_length=255)
    department = models.ForeignKey(Department, on_delete=models.SET_NULL, null=True)
    date_of_joining = models.DateField()
    date_of_exit = models.DateField(null=True, blank=True)
    is_active = models.BooleanField(default=True)


class EmployeeLedger(BaseModel):
    employee = models.OneToOneField(Employee, on_delete=models.CASCADE)
    ledger = models.ForeignKey("accounting.Ledger", on_delete=models.PROTECT)


class PayHead(CompanyScopedModel):
    name = models.CharField(max_length=100)
    pay_type = models.CharField(max_length=20)
    is_taxable = models.BooleanField(default=True)


class EmployeePayStructure(BaseModel):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE)
    pay_head = models.ForeignKey(PayHead, on_delete=models.CASCADE)
    amount = models.DecimalField(max_digits=14, decimal_places=2)
    effective_from = models.DateField()
    effective_to = models.DateField(null=True, blank=True)

logistics/models.py
class Carrier(CompanyScopedModel):
    name = models.CharField(max_length=100)
    phone = models.CharField(max_length=20)
    code = models.CharField(max_length=50)
    is_active = models.BooleanField(default=True)


class Shipment(CompanyScopedModel):
    shipment_number = models.CharField(max_length=50)
    carrier = models.ForeignKey(Carrier, on_delete=models.PROTECT)
    tracking_number = models.CharField(max_length=100)
    shipped_date = models.DateField()
    expected_delivery = models.DateField(null=True, blank=True)
    status = models.CharField(max_length=20)

system/models.py
class AuditLog(BaseModel):
    company = models.ForeignKey("company.Company", null=True, blank=True, on_delete=models.SET_NULL)
    actor_user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True)
    action_type = models.CharField(max_length=50)
    object_type = models.CharField(max_length=100)
    object_id = models.UUIDField()
    changes = models.JSONField()
    ip_address = models.GenericIPAddressField()


class IntegrationEvent(CompanyScopedModel):
    event_type = models.CharField(max_length=100)
    payload = models.JSONField()
    status = models.CharField(max_length=20)
    attempts = models.PositiveIntegerField(default=0)
    last_attempt_at = models.DateTimeField(null=True, blank=True)
